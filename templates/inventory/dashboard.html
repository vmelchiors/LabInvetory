{% extends 'base.html' %}

{% block title %}Dashboard - LabInventory{% endblock %}

{% block content %}
<h2>Dashboard</h2>
<hr>

<h3>Resumo</h3>
<ul>
    <li><strong>{{ total_materials }}</strong> Materiais Cadastrados - <a href="{% url 'material_list' %}">Ver Detalhes</a></li>
    <li><strong>{{ total_categories }}</strong> Categorias - <a href="{% url 'category_list' %}">Ver Detalhes</a></li>
    <li><strong>{{ active_loans }}</strong> Empréstimos Ativos - <a href="{% url 'loan_list' %}?status=active">Ver Detalhes</a></li>
    <li><strong>{{ late_loans }}</strong> Empréstimos Atrasados - <a href="{% url 'loan_list' %}?status=late">Ver Detalhes</a></li>
</ul>

{% if user_active_loans %}
<hr>
<h3>Meus Empréstimos Ativos</h3>
<table border="1" cellpadding="5" cellspacing="0">
    <thead>
        <tr>
            <th>ID</th>
            <th>Data do Empréstimo</th>
            <th>Materiais</th>
            <th>Data Limite</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for loan in user_active_loans %}
        <tr>
            <td>#{{ loan.id }}</td>
            <td>{{ loan.loan_date|date:"d/m/Y H:i" }}</td>
            <td>
                {% for loan_item in loan.loanitem_set.all %}
                    {{ loan_item.material.name }} ({{ loan_item.quantity }}){% if not forloop.last %}, {% endif %}
                {% endfor %}
            </td>
            <td>{{ loan.expected_return_date|date:"d/m/Y H:i" }}</td>
            <td>
                {% if loan.status == 'active' %}
                    Ativo
                {% elif loan.status == 'late' %}
                    Atrasado
                {% endif %}
            </td>
            <td>
                <a href="{% url 'loan_detail' loan.id %}">Ver</a> |
                <a href="{% url 'loan_return' loan.id %}">Devolver</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<hr>
<h3>Ações Rápidas</h3>
<ul>
    <li><a href="{% url 'loan_create' %}">Novo Empréstimo</a></li>
    <li><a href="{% url 'material_list' %}">Buscar Materiais</a></li>
    <li><a href="{% url 'my_loans' %}">Meus Empréstimos</a></li>
    {% if user.is_staff %}
    <li><a href="{% url 'material_create' %}">Adicionar Material</a></li>
    {% endif %}
</ul>
{% endblock %}
